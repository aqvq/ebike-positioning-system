## 硬件选型

### MCU

#### 内核需求

主频要求不高，只要能处理GPS数据以及将数据发送到阿里云即可。此外，FPU也非必须。M0+芯片已经够用了。

#### FLASH/RAM需求

考虑到本项目需要使用OTA，至少有固件两倍大小的FLASH空间，目前固件程序大小为200多KBytes，所以FLASH大小至少要有512KBytes。本程序需要运行动态注册，其中mbedtls运行需要大量RAM空间，至少128KBytes。

#### 外设需求

| 需求 | 数量 | 备注                           |
| ---- | ---- | ------------------------------ |
| UART | 2    | 其中一个带流控RTS/CTS，支持DMA |
| IIC  | 1    | EEPROM芯片用                   |
| SWD  | 1    | 在线调试与烧录                 |
| USB  | 1    | 非必须                         |
| GPIO | 9    | 控制信号                       |

#### 其他需求

- 无特殊的温度需求，-40度到85度即可。
- 为了方便焊接，封装引脚应尽可能少

#### 最终选型

经市场调查筛选了几款STM32的MCU，详细信息另见文档。在成本较低和现货量较大的几款中最终选择了`STM32G0B0RET6`该款芯片。选择该款芯片还有一个原因就是该芯片FLASH有一个特性`dual bank`。两个BANK可以交替映射到`0x0800 0000`，非常适合OTA，如此便不再需要再另写一个bootloader。详细的分区表信息另见文档。

### 外置存储

一般常用的方案是EEPROM和FLASH或者SD卡。本项目只需要将设备ID和密钥以及少量配置信息存储到外置芯片，需求空间量不大。为了控制成本和复杂性，最终选择EEPROM。具体型号使用的是EEPROM里最常见的`AT24C64`，总大小8KBytes。

### 供电方式

本项目有多个供电电压。分别是STM32需要3.3V电压，EC800M需要3.8V电压，有源天线需要独立3.3V电压，EC800M的GPIO电压为1.8V。对外接口采用常见的TYPEC。DCDC芯片选型有：LM1117、SGM2019-3.3、MIC29302WU以及电平转换芯片TXS0108EPWR。

### SIM卡槽

为了减小SIM卡槽占用的面积，选用NanoSim卡槽。此外考察了翻盖式SIM卡槽与自弹式的区别和优劣，考虑到设备SIM卡处于长期插入状态，并且没有更换插拔的需求，为了更好的稳定性（防止震动或者撞击导致退卡而接触不良），最终选择翻盖式SIM卡槽。

### 4G模块

本人对于移远模块较为熟悉，优先考虑移远的产品。本项目主要需求是需要有GPS/BDS定位，定位精度要求不高，需要有4G通信功能。综合考虑需求与成本，最终选择性价比非常高的EC800M这款芯片。

### 其他

- 预留SWD烧录接口、UART调试串口、测试点、零电阻。
- 预留一个电源指示灯、一个4G电源指示灯、一个4G工作状态指示灯。